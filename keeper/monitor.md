# Keeper 监控

为了保证Keeper的正常运行，系统提供了一些保障和监控手段，在“系统”->“Keeper监控”下可以看到。简要介绍如下。

## 服务器状态监控

主要监控服务器的资源占用情况和任务运行情况。

* Qross家目录下所有文件占用的磁盘空间，可手工清理。
* Keeper运行日志占用空间，在“运行日志”页面可以按时间查看运行日志。系统提供了定期清理机制，在[“Keeper设置”](/keeper/settings.md)中可以设置系统日志的保留天数。
* 调度任务日志占用空间，调度任务日志都保存在磁盘中，可以为每个调度作业单独设置[任务记录的保存条数](/keeper/job.md)。
* Keeper服务器的CPU使用率，可指定时间范围。调度程序主要依赖于CPU资源，可根据生产情况[调整CPU并行度](/keeper/settings.md)或升级服务器。
* 服务器内存占用率。
* 执行的任务数量时点统计，指在统计的那个小时时间点（整点）同时运行的任务数量，可根据这个统计来调整调度作业的执行计划，避免调度任务太过集中。
* 命令或脚本的数量时点统计，意义同上一个指标，这个指具体运行了多少程序。

## 运行状态监控

Keeper由多个组件构成，在运行状态下，每个组件工作良好才能保证Keeper可以正常工作。假如发现某个组件“未运行”，可重启Keeper。

Keeper每分钟进行一次心跳，表格的最后一列显示Keeper各组件的最后心跳时间。

在这个监控页可以重启Keeper，重启过程比较慢，因为需要等待已运行的调度任务执行完且各个组件关闭，所以建议在调度任务运行少的时间段进行重启。重新过程中可以“强制关闭”，但强烈不建议这么做，强制关闭只会杀掉Keeper进程，但不会中断正在运行的调度任务。在Keeper重启时，Keeper会重新启动未执行完的任务，所以可能会造成这些调度任务的结果不正确。在Windows系统下不支持重启和强制关闭操作，“重启”只是正常关闭Keeper，关闭后需要手工启动。在Linux下，重启需要配置`crontab`，请参阅[Qross系统安装](/keeper/setup.md)中相应的说明。

## 运行日志

可以按小时查看Keeper的运行日志，这些日志保存在Qross系统家目录的`keeper`文件夹下。

## 错误日志

运行日志中会记录全部的日志，错误日志只显示Keeper运行中的错误。这些错误可能是Keeper本身的bug，也可能是设置问题，这些错误可以帮助使用者快速定位问题。可以将这些错误手工发送给作者。

## 卡死的任务

调度任务有时会卡死，就是一直执行不完，也可能是执行完了进程没退出，虽然很少见但确实存在。一般情况下，Keeper会自动恢复这些任务，但会将这些任务记录下来。

## Keeper启停记录

Keeper的每次启停都会记录下来。通过“重启Keeper”按钮启动Keeper为正常启动，“强制重启”或系统异常造成的重启（当`crontab`检测不到Keeper进程时会重启）为异常启动。正常退出时会记录停机时间和持续时间，异常退出无法记录。

## 工作日历

一般默认为周一到周五为工作日，周六周日为休息日，没有考虑法定节假日和企业本身的工作和休假制度。在工作日历可以设置特殊工作日和休假日，主要用于[Cron表达式](/keeper/cron.md)的工作日`W`和休息日`R`设置。


---
参考链接

* [Qross系统安装](/keeper/setup.md)
* [Keeper设置](/keeper/settings.md)
* [Cron表达式](/keeper/cron.md)

